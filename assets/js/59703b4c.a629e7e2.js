"use strict";(self.webpackChunkmy_blogs=self.webpackChunkmy_blogs||[]).push([[488],{1576:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>t,toc:()=>d});var t=s(3266),i=s(4848),r=s(8453);const o={slug:"sso-saml-intergration-steos",title:"Step-by-Step Guide to Implementing IdP-Initiated SSO SAML Integration",authors:["sahil"],tags:["sso","saml"]},a=void 0,l={authorsImageUrls:[void 0]},d=[{value:"Step 1: Create a Private and Public RSA Key",id:"step-1-create-a-private-and-public-rsa-key",level:2},{value:"Why Do You Need RSA Keys?",id:"why-do-you-need-rsa-keys",level:3},{value:"How to Generate RSA Keys Using OpenSSL",id:"how-to-generate-rsa-keys-using-openssl",level:3},{value:"Step 2: Get the Required SAML Metadata",id:"step-2-get-the-required-saml-metadata",level:2},{value:"Identity Provider (IdP) Information",id:"identity-provider-idp-information",level:3},{value:"Service Provider (SP) Information",id:"service-provider-sp-information",level:3},{value:"Step 3: Share the Public Key with the SP",id:"step-3-share-the-public-key-with-the-sp",level:2},{value:"How to Share the Public Key",id:"how-to-share-the-public-key",level:3},{value:"Step 4: Generate the SAML Response",id:"step-4-generate-the-saml-response",level:2},{value:"Structure of a SAML Response",id:"structure-of-a-saml-response",level:3},{value:"<strong>Example SAML Response (Before Signing)</strong>",id:"example-saml-response-before-signing",level:3},{value:"Step 5: Sign the SAML Response",id:"step-5-sign-the-saml-response",level:2},{value:"Signing the Response in Node.js",id:"signing-the-response-in-nodejs",level:3},{value:"Step 6: Send SAML Response Using HTTP POST Binding",id:"step-6-send-saml-response-using-http-post-binding",level:2},{value:"Example HTML Form for Posting SAML Response",id:"example-html-form-for-posting-saml-response",level:3},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Single Sign-On (SSO) is a powerful authentication method that enables users to log in once and gain access to multiple applications without needing to re-enter credentials. ",(0,i.jsx)(n.strong,{children:"SAML (Security Assertion Markup Language)"})," is one of the most widely used protocols for implementing SSO."]}),"\n",(0,i.jsxs)(n.p,{children:["In this blog, we will walk through the detailed steps to implement ",(0,i.jsx)(n.strong,{children:"IdP-initiated SSO SAML integration"}),". This type of SSO flow is initiated by the Identity Provider (IdP) and does not require an initial authentication request from the Service Provider (SP). Instead, the IdP generates a ",(0,i.jsx)(n.strong,{children:"SAML Response"})," and directly redirects the user to the SP."]}),"\n",(0,i.jsx)(n.h2,{id:"step-1-create-a-private-and-public-rsa-key",children:"Step 1: Create a Private and Public RSA Key"}),"\n",(0,i.jsx)(n.h3,{id:"why-do-you-need-rsa-keys",children:"Why Do You Need RSA Keys?"}),"\n",(0,i.jsxs)(n.p,{children:["SAML responses must be ",(0,i.jsx)(n.strong,{children:"digitally signed"})," to ensure their authenticity and integrity. To do this, you need a ",(0,i.jsx)(n.strong,{children:"private key"})," for signing the SAML assertion and a ",(0,i.jsx)(n.strong,{children:"public key"})," for verification by the Service Provider."]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-generate-rsa-keys-using-openssl",children:"How to Generate RSA Keys Using OpenSSL"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generate a Private Key:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"openssl genrsa -out private-key.pem 3072\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generate the Corresponding Public Key:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"openssl rsa -in private-key.pem -pubout -out public-key.pem\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generate an X.509 Certificate (Optional, but recommended):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"openssl req -new -x509 -key private_key.pem -out certificate.pem -days 365\n"})}),"\n","This certificate is used to verify the signature of the SAML response."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Now you have:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Private Key (private_key.pem)"})," \u2013 Used to sign the SAML response."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Public Key (public_key.pem)"})," \u2013 Shared with the SP for verification."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Certificate (certificate.pem)"})," \u2013 Used by the SP to validate signatures."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"step-2-get-the-required-saml-metadata",children:"Step 2: Get the Required SAML Metadata"}),"\n",(0,i.jsx)(n.p,{children:"Before generating the SAML response, you need the necessary metadata from both the IdP and SP. The key details include:"}),"\n",(0,i.jsx)(n.h3,{id:"identity-provider-idp-information",children:"Identity Provider (IdP) Information"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"IdP Entity ID"}),": The unique identifier for the IdP."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single Sign-On (SSO) URL"}),": The URL where the IdP sends the SAML response."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"service-provider-sp-information",children:"Service Provider (SP) Information"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SP Entity ID"}),": The unique identifier for the SP."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SP Assertion Consumer Service (ACS) URL"}),": The URL where the SAML response should be sent."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Target URL"}),": The URL where users will be redirected after authentication."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Destination of the Response"}),": The expected destination in the SAML response."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example of metadata retrieval:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If using ",(0,i.jsx)(n.strong,{children:"MockSAML"}),", the SP metadata can be found at:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://mocksaml.com/api/saml/metadata",children:"https://mocksaml.com/api/saml/metadata"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This metadata provides the necessary details to construct the SAML response."}),"\n",(0,i.jsx)(n.h2,{id:"step-3-share-the-public-key-with-the-sp",children:"Step 3: Share the Public Key with the SP"}),"\n",(0,i.jsxs)(n.p,{children:["Before the SP can validate SAML responses from the IdP, it needs access to the ",(0,i.jsx)(n.strong,{children:"public key or certificate"})," that was used to sign the responses."]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-share-the-public-key",children:"How to Share the Public Key"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Provide the public key (public_key.pem) to the SP"})," manually or through a metadata file."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use an X.509 certificate (certificate.pem)"})," to make validation easier."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"If the SP supports metadata exchange"}),", provide an XML metadata file that includes the public key:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<md:EntityDescriptor xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata" entityID="https://idp.example.com">\n    <md:IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol">\n        <md:KeyDescriptor use="signing">\n            <ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#">\n                <ds:X509Data>\n                    <ds:X509Certificate>MIIC4jCCAc...</ds:X509Certificate>\n                </ds:X509Data>\n            </ds:KeyInfo>\n        </md:KeyDescriptor>\n    </md:IDPSSODescriptor>\n</md:EntityDescriptor>\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The SP will use this key to validate signatures on the SAML responses."}),"\n",(0,i.jsx)(n.h2,{id:"step-4-generate-the-saml-response",children:"Step 4: Generate the SAML Response"}),"\n",(0,i.jsxs)(n.p,{children:["Once you have the metadata, it's time to generate the ",(0,i.jsx)(n.strong,{children:"SAML Response"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"structure-of-a-saml-response",children:"Structure of a SAML Response"}),"\n",(0,i.jsxs)(n.p,{children:["A valid ",(0,i.jsx)(n.strong,{children:"SAML Response"})," consists of:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Issuer"})," \u2013 The IdP Entity ID."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Assertion"})," \u2013 Contains authentication details, subject information, and attributes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Signature"})," \u2013 Ensures the response integrity."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-saml-response-before-signing",children:(0,i.jsx)(n.strong,{children:"Example SAML Response (Before Signing)"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<samlp:Response xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" \n    Destination="https://sp.example.com/sso" \n    ID="_12345" \n    InResponseTo="" \n    IssueInstant="2025-04-01T12:34:56Z" \n    Version="2.0">\n    \n    <saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">\n        https://idp.example.com\n    </saml:Issuer>\n\n    <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" ID="_67890">\n        <saml:Subject>\n            <saml:NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">\n                user@example.com\n            </saml:NameID>\n        </saml:Subject>\n    </saml:Assertion>\n\n</samlp:Response>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-5-sign-the-saml-response",children:"Step 5: Sign the SAML Response"}),"\n",(0,i.jsxs)(n.p,{children:["To ensure the SAML response is trusted, it must be signed using the ",(0,i.jsx)(n.strong,{children:"private key"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"signing-the-response-in-nodejs",children:"Signing the Response in Node.js"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'import { SignedXml } from "xml-crypto";\n\nconst sig = new SignedXml();\nsig.signingKey = privateKey;\nsig.addReference("//*[local-name(.)=\'Assertion\']");\nsig.computeSignature(samlResponse);\n\nconst signedSAML = sig.getSignedXml();\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Now your ",(0,i.jsx)(n.strong,{children:"SAML Response is signed"})," and ready to be sent."]}),"\n",(0,i.jsx)(n.h2,{id:"step-6-send-saml-response-using-http-post-binding",children:"Step 6: Send SAML Response Using HTTP POST Binding"}),"\n",(0,i.jsxs)(n.p,{children:["Once the SAML response is generated and signed, it needs to be sent to the ",(0,i.jsx)(n.strong,{children:"SP Assertion Consumer Service (ACS) URL"})," via an ",(0,i.jsx)(n.strong,{children:"HTTP POST request"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"example-html-form-for-posting-saml-response",children:"Example HTML Form for Posting SAML Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<form method="POST" action="https://sp.example.com/sso">\n    <input type="hidden" name="SAMLResponse" value="BASE64_ENCODED_SAML">\n    <input type="submit" value="Login">\n</form>\n<script>\n    document.forms[0].submit();\n<\/script>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This form automatically ",(0,i.jsx)(n.strong,{children:"redirects the user"})," to the SP with the SAML response."]}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(n.p,{children:["By following these steps, you can successfully implement ",(0,i.jsx)(n.strong,{children:"IdP-initiated SSO using SAML"}),". Here\u2019s a recap:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generate RSA Keys"})," \u2013 Create private and public keys for signing SAML responses."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retrieve Metadata"})," \u2013 Get Entity IDs, ACS URL, and other details from IdP and SP."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Share the Public Key with the SP"})," \u2013 Ensure the SP can verify your signed SAML responses."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generate SAML Response"})," \u2013 Construct the XML structure with authentication details."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sign the Response"})," \u2013 Use OpenSSL or xml-crypto to sign the response."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Send via HTTP POST"})," \u2013 Encode and transmit the response to the SP ACS URL."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["By using tools like ",(0,i.jsx)(n.strong,{children:"OpenSSL, SAML Tracer, and SAMLTool.com"}),", you can debug and validate your SAML integration efficiently."]})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},3266:e=>{e.exports=JSON.parse('{"permalink":"/my-blogs/blog/sso-saml-intergration-steos","source":"@site/blog/2023-05-01-sso-saml/index.md","title":"Step-by-Step Guide to Implementing IdP-Initiated SSO SAML Integration","description":"Single Sign-On (SSO) is a powerful authentication method that enables users to log in once and gain access to multiple applications without needing to re-enter credentials. SAML (Security Assertion Markup Language) is one of the most widely used protocols for implementing SSO.","date":"2023-05-01T00:00:00.000Z","tags":[{"inline":false,"label":"SSO","permalink":"/my-blogs/blog/tags/sso","description":"Single Sign-On (SSO)"},{"inline":false,"label":"SAML","permalink":"/my-blogs/blog/tags/saml","description":"Security Assertion Markup Language (SAML)"}],"readingTime":4.27,"hasTruncateMarker":true,"authors":[{"name":"Sahil Phondekar","title":"Sr. Software Engineer @Everestek","url":"https://github.com/sahil-phondekar","page":{"permalink":"/my-blogs/blog/authors/sahil"},"socials":{"linkedin":"https://www.linkedin.com/in/sahil-phondekar/","x":"https://x.com/sahilphondekar","github":"https://github.com/sahil-phondekar"},"imageURL":"https://github.com/sahil-phondekar.png","key":"sahil"}],"frontMatter":{"slug":"sso-saml-intergration-steos","title":"Step-by-Step Guide to Implementing IdP-Initiated SSO SAML Integration","authors":["sahil"],"tags":["sso","saml"]},"unlisted":false,"prevItem":{"title":"Spring Boot JWT Authentication with Spring Security \u2014 Complete Step-by-Step Guide","permalink":"/my-blogs/blog/spring-security-intergration"},"nextItem":{"title":"Tools I Use for Generating & Testing Valid SAML Responses","permalink":"/my-blogs/blog/sso-saml-tools"}}')},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);